<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xiaoxin.blog.web.app.mapper.CategoryMapper">
    <resultMap id="CategoryVoMap" type="com.xiaoxin.blog.web.app.vo.CategoryVo">
        <id column="id" property="id"/>
        <result column="name" property="name"/>
        <result column="article_count" property="articleCount"/>
    </resultMap>



    <!-- 方案A：固定条件 deleted=0, status=1 -->
    <select id="selectAllWithArticleCount" resultMap="CategoryVoMap">
        SELECT
            c.id,
            c.name,
            COALESCE(a.cnt, 0) AS article_count
        FROM category c
                 LEFT JOIN (
            SELECT category_id, COUNT(1) AS cnt
            FROM article
            WHERE deleted = 0
              AND status = 1
            GROUP BY category_id
        ) a ON a.category_id = c.id
        WHERE c.deleted = 0
        ORDER BY c.id ASC
    </select>
    <select id="selectHotCategories" resultMap="CategoryVoMap">
        SELECT
            c.id,
            c.name,
            COALESCE(a.cnt, 0) AS article_count
        FROM category c
                 LEFT JOIN (
            SELECT category_id, COUNT(1) AS cnt
            FROM article
            WHERE deleted = 0
              AND status = 1
            GROUP BY category_id
        ) a ON a.category_id = c.id
        WHERE c.deleted = 0
        ORDER BY a.cnt DESC, c.id ASC
        LIMIT #{limit}
    </select>
</mapper>
